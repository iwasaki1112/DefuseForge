# API定義書ガイドライン

本プロジェクトのAPI定義書を作成する際のフォーマットと記述ルールです。

## ドキュメント構造

API定義書は以下のセクションで構成します：

```
1. タイトル・概要
2. 定数・enum定義（該当する場合）
3. メソッドリファレンス（カテゴリ別）
4. クラス定義（該当する場合）
5. シグナル
6. 使用例
7. 関連ファイル
```

---

## 1. タイトル・概要

### フォーマット

```markdown
# {API名} リファレンス

{APIの説明を1-2文で記述}

## 概要

\`\`\`gdscript
# 基本的な使用方法（3-5行程度）
{コード例}
\`\`\`
```

### 例

```markdown
# Character API リファレンス

キャラクター操作の統一APIリファレンスです。すべての操作は`CharacterAPI`クラスの静的メソッドで提供されます。

## 概要

\`\`\`gdscript
CharacterAPI.equip_weapon(player, CharacterSetup.WeaponId.AK47)
CharacterAPI.move_to(player, Vector3(10, 0, 5), true)
\`\`\`
```

---

## 2. 定数・enum定義

enum値や定数がある場合は、メソッドリファレンスの前に記載します。

### フォーマット

```markdown
## {カテゴリ名}定義

### {enum名}

`{クラス名}.{enum名}` で定義されています。

| {カラム1} | {カラム2} | {カラム3} |
|-----------|-----------|-----------|
| 値 | 説明 | 補足 |

\`\`\`gdscript
# コード例
{enum名}.{値}
\`\`\`
```

### 例

```markdown
## 武器ID・タイプ定義

### WeaponId（武器ID）

`CharacterSetup.WeaponId` で定義されています。

| ID | 名前 | 説明 |
|----|------|------|
| `NONE` | なし | 武器なし |
| `AK47` | AK-47 | アサルトライフル |

\`\`\`gdscript
CharacterSetup.WeaponId.AK47   # 1
\`\`\`
```

---

## 3. メソッドリファレンス

メソッドは機能カテゴリ別にセクション分けします。

### セクション構造

```markdown
## {カテゴリ名}API

### {メソッド名}
{メソッドの説明（1文）}

\`\`\`gdscript
# コード例（1-3行）
{使用例}
\`\`\`

| パラメータ | 型 | 説明 |
|-----------|-----|------|
| {param1} | {type} | {description} |

**戻り値:** `{type}` - {description}

**処理内容:**（複雑なメソッドの場合のみ）
- {処理1}
- {処理2}
```

### 記述ルール

#### パラメータテーブル
- すべてのメソッドにパラメータテーブルを記載
- デフォルト値がある場合は説明欄に「デフォルト: {値}」を追加
- 省略可能なパラメータは説明欄に「（省略可）」を追加

#### 戻り値
- すべてのメソッドに戻り値を記載
- 戻り値がない場合は `**戻り値:** \`void\``
- Dictionary/Arrayを返す場合は構造をコードブロックで示す

#### 処理内容
以下のいずれかに該当する場合のみ記載：
- 副作用がある（シグナル発行、状態変更など）
- 内部で複数の処理を行う
- 他のシステムと連携する

### 例

```markdown
## 武器API

### equip_weapon
武器を装備します。

\`\`\`gdscript
CharacterAPI.equip_weapon(character, CharacterSetup.WeaponId.AK47)
\`\`\`

| パラメータ | 型 | 説明 |
|-----------|-----|------|
| character | CharacterBase | 対象キャラクター |
| weapon_id | int | 武器ID（CharacterSetup.WeaponId） |

**戻り値:** `void`

**処理内容:**
- 武器モデルを右手ボーン（mixamorig_RightHand）にアタッチ
- 武器タイプに応じたアニメーションに自動切替
- `weapon_changed` シグナルを発行
```

### 戻り値がDictionaryの場合

```markdown
**戻り値:** `Dictionary` - 速度情報

\`\`\`gdscript
{
    "walk": float,       # 実際の歩行速度
    "run": float,        # 実際の走行速度
    "modifier": float    # 武器による速度倍率
}
\`\`\`
```

---

## 4. クラス定義

関連するクラスの構造を記載します。

### フォーマット

```markdown
## {クラス名}クラス

{クラスの説明}

**ファイル:** `{パス}`

\`\`\`gdscript
class_name {ClassName}
extends {ParentClass}

# 主要なプロパティ
var property1: Type = default
var property2: Type = default
\`\`\`

**主要メソッド:**

| メソッド | 戻り値 | 説明 |
|----------|--------|------|
| `method1(args)` | Type | 説明 |
| `method2(args)` | Type | 説明 |
```

---

## 5. シグナル

クラスが発行するシグナルを記載します。

### フォーマット

```markdown
## シグナル

### {クラス名} シグナル

| シグナル | パラメータ | 説明 |
|----------|-----------|------|
| `signal_name` | `param: Type` | 説明 |

### 使用例

\`\`\`gdscript
{オブジェクト}.{signal_name}.connect(_on_{signal_name})

func _on_{signal_name}(param: Type) -> void:
    pass
\`\`\`
```

---

## 6. 使用例

実際のユースケースに基づいた具体的なコード例を記載します。

### フォーマット

```markdown
## 使用例

### {ユースケース名}

\`\`\`gdscript
{完全なコード例}
\`\`\`
```

### 記述ルール
- 3-5個程度の代表的なユースケースを記載
- 各例は10-20行程度のコードで完結
- コメントで処理の流れを説明

---

## 7. 関連ファイル

APIに関連するファイル一覧を記載します。

### フォーマット

```markdown
## 関連ファイル

| ファイル | 説明 |
|----------|------|
| `path/to/file.gd` | 説明 |
```

---

## スタイルガイド

### マークダウン記法

| 要素 | 記法 |
|------|------|
| クラス名 | `\`ClassName\`` |
| メソッド名 | `\`method_name()\`` |
| パラメータ | `\`param_name\`` |
| ファイルパス | `\`path/to/file.gd\`` |
| コードブロック | \`\`\`gdscript ... \`\`\` |

### 命名規則

- セクションタイトル: 「{機能}API」（例: 武器API、視界API）
- メソッド見出し: メソッド名のみ（例: `### equip_weapon`）
- ユースケース見出し: 動詞で始める（例: 「敵を発見して攻撃」）

### 文体

- 説明文は「です・ます」調を使用
- メソッド説明は1文で簡潔に
- パラメータ説明は体言止め

---

## チェックリスト

API定義書を作成・更新する際は以下を確認してください：

- [ ] タイトルと概要が記載されている
- [ ] すべてのメソッドにパラメータテーブルがある
- [ ] すべてのメソッドに戻り値が記載されている
- [ ] Dictionary/Array戻り値の構造が示されている
- [ ] 副作用があるメソッドに処理内容が記載されている
- [ ] シグナルセクションがある（シグナルがある場合）
- [ ] 使用例が3-5個ある
- [ ] 関連ファイルセクションがある
- [ ] コードブロックはすべて`gdscript`で記述されている

---

## テンプレート

新規API定義書を作成する際は以下のテンプレートを使用してください：

```markdown
# {API名} リファレンス

{APIの説明}

## 概要

\`\`\`gdscript
# 基本的な使用方法
\`\`\`

---

## {カテゴリ1}API

### {メソッド名}
{説明}

\`\`\`gdscript
{使用例}
\`\`\`

| パラメータ | 型 | 説明 |
|-----------|-----|------|
| param | Type | 説明 |

**戻り値:** `Type` - 説明

---

## {クラス名}クラス

**ファイル:** `path/to/file.gd`

---

## シグナル

| シグナル | パラメータ | 説明 |
|----------|-----------|------|
| signal_name | param: Type | 説明 |

---

## 使用例

### {ユースケース名}

\`\`\`gdscript
{コード例}
\`\`\`

---

## 関連ファイル

| ファイル | 説明 |
|----------|------|
| `path/to/file.gd` | 説明 |
```
